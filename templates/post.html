{% extends "base.html" %}
{% block title %}{{ post.title }}{% endblock %}
{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Хлебные крошки -->
    <nav class="text-sm breadcrumbs mb-6">
        <a href="{{ url_for('home') }}" class="text-gray-500 hover:text-red-600">Главная</a> 
        <span class="mx-2 text-gray-400">/</span>
        <span class="text-gray-700">{{ post.title }}</span>
    </nav>

    <!-- Главная картинка -->
    {% if post.main_image_url %}
    <div class="mb-8 overflow-hidden rounded-xl shadow-lg">
        <img src="{{ post.main_image_url }}" alt="{{ post.title }}" class="w-full h-96 object-cover">
    </div>
    {% endif %}

    <!-- Заголовок и мета -->
    <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 mb-4">{{ post.title }}</h1>
    
    <div class="flex items-center justify-between text-sm text-gray-500 mb-8 border-b pb-4">
        <div class="flex items-center space-x-4">
            <span>{{ post.date_posted.strftime('%d.%m.%Y') }}</span>
            <span>Просмотров: {{ post.views }}</span>
        </div>
        <div class="flex items-center space-x-4">
            <form method="POST" action="{{ url_for('react', post_id=post.id, reaction_type='like') }}" class="inline">
                <button type="submit" class="flex items-center space-x-1 text-green-600 hover:text-green-800">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h.857a4 4 0 003.787-2.722 4 4 0 003.787-2.722 4 4 0 003.787-2.722 4 4 0 003.787-2.722 4 4 0 003.787-2.722 4 4 0 003.787-2.722A4 4 0 0012.14 2H8.943a4 4 0 00-3.787 2.722A4 4 0 003.787 7.278a4 4 0 00-3.787 2.722 4 4 0 00-3.787 2.722z"/></svg>
                    <span>{{ post.likes }}</span>
                </button>
            </form>
            <form method="POST" action="{{ url_for('react', post_id=post.id, reaction_type='dislike') }}" class="inline">
                <button type="submit" class="flex items-center space-x-1 text-red-600 hover:text-red-800">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M18 9.5a1.5 1.5 0 11-3 0v-6a1.5 1.5 0 013 0v6zM14 9.667v-5.43a2 2 0 00-1.105-1.79l-.05-.025A4 4 0 0011.055 2H10.2a4 4 0 00-3.787 2.722A4 4 0 002.626 7.278a4 4 0 00-3.787 2.722A4 4 0 00-3.787 12.722a4 4 0 00-3.787 2.722A4 4 0 00-3.787 18h3.787a4 4 0 003.787-2.722A4 4 0 003.787 12.722a4 4 0 003.787-2.722A4 4 0 0011.055 7.278a4 4 0 003.787-2.722A4 4 0 0018 5.667z"/></svg>
                    <span>{{ post.dislikes }}</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Текст новости -->
    <div class="prose prose-lg max-w-none mb-12 text-gray-800">
        {{ post.content | markdown | safe }}
    </div>

    <!-- Галерея изображений (если есть дополнительные) -->
    {% if post.images|length > 1 %}
    <div class="mb-12">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Галерея</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for img in post.images[1:] %}
            <div class="overflow-hidden rounded-lg shadow-md hover:shadow-xl transition">
                <img src="{{ img.url }}" alt="Галерея" class="w-full h-64 object-cover">
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Комментарии -->
    <div id="comments" class="mt-12 border-t pt-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Комментарии ({{ post.comments|length }})</h2>
        
        {% if post.comments %}
        <div class="space-y-6">
            {% for comment in post.comments %}
            <div class="bg-gray-50 p-6 rounded-lg">
                <div class="flex items-center justify-between mb-2">
                    <span class="font-semibold text-gray-800">{{ comment.username }}</span>
                    <span class="text-sm text-gray-500">{{ comment.date_posted.strftime('%d.%m.%Y %H:%M') }}</span>
                </div>
                <p class="text-gray-700">{{ comment.content | linebreaks }}</p>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-gray-500">Пока нет комментариев. Будьте первым!</p>
        {% endif %}

        <!-- Форма добавления комментария -->
        <div class="mt-8 bg-white p-6 rounded-lg shadow">
            <h3 class="text-xl font-semibold mb-4">Оставить комментарий</h3>
            <form method="POST" action="{{ url_for('add_comment', post_id=post.id) }}">
                <div class="mb-4">
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Ваше имя</label>
                    <input type="text" name="username" id="username" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                </div>
                <div class="mb-4">
                    <label for="content" class="block text-sm font-medium text-gray-700 mb-1">Комментарий</label>
                    <textarea name="content" id="content" rows="4" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"></textarea>
                </div>
                <button type="submit" class="px-6 py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition">
                    Отправить
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock %}